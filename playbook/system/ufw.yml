---
- hosts: all
  become: true

  tasks:
    - name: Update apt and install required system packages
      apt:
        pkg:
          - kmod
          - ufw
        state: latest
        update_cache: true

    - name: UFW rules
      community.general.ufw:
        rule: "allow"
        port: "{{ item }}"
        proto: "tcp"
      with_items:
        - "22"
        - "80"
        - "443"

    - name: Incoming deny
      community.general.ufw:
        state: enabled
        direction: incoming
        policy: deny

